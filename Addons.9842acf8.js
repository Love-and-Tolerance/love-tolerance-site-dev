import{$ as h,q as D,v as C,w as p,c as W,d as R,j as x,x as N,g as b,p as O,i as $,n as m,b as S,y as X,r as F,F as U,z as Y,s as A,S as M,t as _,E as Q}from"./chunks/web.a5032f89.js";import{G as L,B as Z,h as ee}from"./chunks/schemas.544b4dd5.js";import{m as l}from"./chunks/index.cf4744a4.js";const j=Symbol("store-raw"),v=Symbol("store-node"),ne=Symbol("store-name");function B(n){let e;return n!=null&&typeof n=="object"&&(n[h]||!(e=Object.getPrototypeOf(n))||e===Object.prototype||Array.isArray(n))}function w(n,e=new Set){let t,i,o,r;if(t=n!=null&&n[j])return t;if(!B(n)||e.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):e.add(n);for(let c=0,s=n.length;c<s;c++)o=n[c],(i=w(o,e))!==o&&(n[c]=i)}else{Object.isFrozen(n)?n=Object.assign({},n):e.add(n);const c=Object.keys(n),s=Object.getOwnPropertyDescriptors(n);for(let a=0,f=c.length;a<f;a++)r=c[a],!s[r].get&&(o=n[r],(i=w(o,e))!==o&&(n[r]=i))}return n}function P(n){let e=n[v];return e||Object.defineProperty(n,v,{value:e={}}),e}function k(n,e,t){return n[e]||(n[e]=T(t))}function K(n){if(C()){const e=P(n);(e._||(e._=T()))()}}function te(n){return K(n),Reflect.ownKeys(n)}function T(n){const[e,t]=W(n,{equals:!1,internal:!0});return e.$=t,e}function E(n,e,t,i=!1){if(!i&&n[e]===t)return;const o=n[e],r=n.length;t===void 0?delete n[e]:n[e]=t;let c=P(n),s;(s=k(c,e,o))&&s.$(()=>t),Array.isArray(n)&&n.length!==r&&(s=k(c,"length",r))&&s.$(n.length),(s=c._)&&s.$()}function se(n,e){const t=Reflect.getOwnPropertyDescriptor(n,e);return!t||t.get||t.set||!t.configurable||e===h||e===v||e===ne||(delete t.value,delete t.writable,t.get=()=>n[h][e],t.set=i=>n[h][e]=i),t}const ie={get(n,e,t){if(e===j)return n;if(e===h)return t;if(e===D)return K(n),t;const i=P(n),o=i.hasOwnProperty(e);let r=o?i[e]():n[e];if(e===v||e==="__proto__")return r;if(!o){const c=Object.getOwnPropertyDescriptor(n,e),s=typeof r=="function";if(C()&&(!s||n.hasOwnProperty(e))&&!(c&&c.get))r=k(i,e,r)();else if(r!=null&&s&&r===Array.prototype[e])return(...a)=>p(()=>Array.prototype[e].apply(t,a))}return B(r)?q(r):r},has(n,e){return e===j||e===h||e===D||e===v||e==="__proto__"?!0:(this.get(n,e,n),e in n)},set(n,e,t){return p(()=>E(n,e,w(t))),!0},deleteProperty(n,e){return p(()=>E(n,e,void 0,!0)),!0},ownKeys:te,getOwnPropertyDescriptor:se};function q(n,e){let t=n[h];if(!t){Object.defineProperty(n,h,{value:t=new Proxy(n,ie)});const i=Object.keys(n),o=Object.getOwnPropertyDescriptors(n);for(let r=0,c=i.length;r<c;r++){const s=i[r];if(o[s].get){const a=o[s].get.bind(t);Object.defineProperty(n,s,{get:a})}if(o[s].set){const a=o[s].set;Object.defineProperty(n,s,{set:g=>p(()=>a.call(t,g))})}}}return t}function re(n,e){const t=w(n||{});return q(t)}const oe=_('<div class="card card--row"><div class="card__image"><img class="img--pixelated" alt="Addon icon"></div><div class="card__body flex flex--xsmall"><h5 class="card__title"></h5><div class="flex flex--row flex--small"></div><div class="card__content"><!#><!/><!#><!/></div></div></div>'),ae=_('<button type="button"></button>'),ce=_("<a>GitHub</a>"),le=n=>{const e=x(()=>n.info.getVariant(n.variantId)),t=x(()=>e().image??n.defaultImage),[i]=N(e,o=>o.getDescription());return(()=>{const o=b(oe),r=o.firstChild,c=r.firstChild,s=r.nextSibling,a=s.firstChild,f=a.nextSibling,g=f.nextSibling,y=g.firstChild,[V,z]=O(y.nextSibling),G=V.nextSibling,[H,J]=O(G.nextSibling);return $(a,()=>n.info.name),$(f,m(U,{get each(){return[...n.info.variants.values()]},children:d=>(()=>{const u=b(ae);return u.$$click=()=>n.onVariantSelect(d.id),$(u,()=>d.name),S(()=>X(u,`btn ${e()===d?"btn--primary":"btn--light"}`)),F(),u})()})),$(g,m(Y,{fallback:"Loading ...",get children(){return i()??"No description"}}),V,z),$(g,m(M,{get when(){return e().repo},keyed:!0,children:d=>[" ","(",(()=>{const u=b(ce);return S(()=>A(u,"href",d.getUrl())),u})(),")"]}),H,J),S(d=>{const u=t()===n.defaultImage,I=t();return u!==d._v$&&c.classList.toggle("img--faded",d._v$=u),I!==d._v$2&&A(c,"src",d._v$2=I),d},{_v$:void 0,_v$2:void 0}),o})()};R(["click"]);class de{id;name;repo;image;description;constructor(e){this.id=e.id,this.name=e.name,e.url!==void 0&&(this.repo=L.fromUrl(e.url,e.branch)),e["pack.png"]!==void 0?this.image=e["pack.png"]:this.repo!==void 0&&(this.image=this.repo.rawContentUrl("pack.png"))}async getDescription(){if(this.description===void 0&&this.repo!==void 0){const e=await this.repo.fetchInfo();this.description=e.description}return this.description??null}}class fe{name;idPos;defaultVariant;variants=new Map;constructor(e){this.name=e.name,this.idPos=e.id_pos;for(const t of e.variants){const i=new de(t);this.variants.set(i.id,i)}this.defaultVariant=this.getVariant(e.default)}getVariant(e){const t=this.variants.get(e);if(t===void 0)throw new Error(`Variant id "${e}" is not registered`);return t}}class ue{base;addons=[];constructor(e){this.base=new ge(e.repos.base);for(const t of e.repos.addons){const i=new fe(t);this.addons[i.idPos-1]=i}}}class ge{repo;mcVersions;version;image;tag;releaseUrl;filename;constructor(e){this.repo=L.fromUrl(e.url,e.tag),this.mcVersions=e.mc_versions,this.version=e.version,this.image=this.repo.rawContentUrl("pack.png"),this.tag=e.tag,this.releaseUrl=e.release_url,this.filename=e.filename}getFilename(e){const t=e.join(""),i=this.filename.replace("{version}",this.version).replace("{ids}",t);return this.releaseUrl.replace("{tag}",this.tag).replace("{filename}",i)}}const he=l.object({name:l.string(),id:l.string(),branch:l.optional(l.string()),url:l.optional(l.string()),"pack.png":l.optional(l.string()),description:l.optional(l.string())}),be=l.object({name:l.string(),id_pos:l.number(),default:l.string(),variants:l.array(he)}),me=l.object({repos:l.object({base:Z,addons:l.array(be)})}),_e=_("<h3>Minecraft versions: <!#><!/></h3>"),$e=_('<div class="flex flex--row flex--small"><button class="btn btn--primary btn--medium" type="button">Reset</button><button class="btn btn--primary btn--medium" type="button">Select defaults</button><a class="btn btn--primary btn--medium"><span class="btn-label">Download</span><span class="btn-icon btn-icon--right"><i class="fas fa-arrow-up-right-from-square"></i></span></a></div>'),pe=_('<div class="grid grid--col-2"></div>'),ve=_("<h2>Custom Java downloads</h2>"),Se=_("<h2>Loading...</h2>"),we="https://raw.githubusercontent.com/Love-and-Tolerance/pack-dev-tools/mane/assets/java.json";async function ye(){const n=await fetch(we,{headers:{Accept:"application/json"}});if(n.status!==200)throw new Error(`Failed to fetch assets json: ${n.status}`);const e=await n.json(),t=me.parse(e);return new ue(t)}const xe=n=>{const e=re(n.info.addons.map(s=>s.defaultVariant.id)),t=x(()=>n.info.base.getFilename(e));function i(s){return e[s-1]??"x"}function o(s,a){e[s-1]=a}function r(){p(()=>{for(let s=0;s<e.length;s++)e[s]="x"})}function c(){p(()=>{for(const s of n.info.addons)e[s.idPos-1]=s.defaultVariant.id})}return[(()=>{const s=b(_e),a=s.firstChild,f=a.nextSibling,[g,y]=O(f.nextSibling);return $(s,()=>n.info.base.mcVersions,g,y),s})(),(()=>{const s=b($e),a=s.firstChild,f=a.nextSibling,g=f.nextSibling;return a.$$click=r,f.$$click=c,S(()=>A(g,"href",t())),F(),s})(),(()=>{const s=b(pe);return $(s,m(U,{get each(){return n.info.addons},children:a=>m(le,{info:a,get defaultImage(){return n.info.base.image},get variantId(){return i(a.idPos)},get onVariantSelect(){return o.bind(null,a.idPos)}})})),s})()]},ke=()=>{const[n]=N(ye);return[b(ve),m(Q,{fallback:ee,get children(){return m(M,{get when(){return n()},keyed:!0,get fallback(){return b(Se)},children:e=>m(xe,{info:e})})}})]};R(["click"]);export{ke as Addons};
